metadata:
  cve_ids:
    - CVE-2021-34527
  name: PrintNightmare
  aliases:
    - Windows Print Spooler RCE
  severity: high
  description: >-
    Remote code execution in the Windows Print Spooler service that can be triggered after an attacker
    gains SMB access to stage malicious drivers or DLLs.
heuristic:
  required_signals: 2
  base_weight: 25
  risk_band: medium
  conditions:
    - signal: has_print_share
      expectation: true
      rationale: Presence of the PRINT$ share indicates the spooler service is exposed.
    - signal: host.os_detection
      expectation: windows server
      rationale: Server-class hosts often run always-on spooler services.
    - signal: host.os_detection
      expectation: windows 10
      rationale: Workstations running Windows 10 remained vulnerable prior to July 2021 updates.
  boosters:
    - description: Anonymous or guest access detected on SMB shares enables easier driver staging.
      weight: 8
    - description: Host exposes ADMIN$/C$ shares, providing immediate lateral movement paths post-exploitation.
      weight: 5
telemetry:
  existing_sources:
    - probe_runner
    - access_runner
  needed_enhancements:
    - spooler_version_sampling
references:
  - label: Microsoft Security Response Center (CVE-2021-34527)
    url: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527
  - label: CERT/CC VU#383432
    url: https://kb.cert.org/vuls/id/383432
notes:
  remediation_summary: Apply latest cumulative updates and disable Point and Print or restrict driver installation to admins.
  reporting_tip: Recommend disabling the spooler on servers that do not require printing services.
