metadata:
  cve_ids:
    - CVE-2021-36942
  name: PetitPotam
  aliases:
    - EFSRPC coerced authentication
  severity: high
  description: >-
    Coerces NTLM authentication by abusing the EFSRPC interface over SMB named pipes,
    enabling relay attacks that can lead to RCE on downstream systems.
heuristic:
  required_signals: 2
  base_weight: 20
  risk_band: low
  conditions:
    - signal
      expectation: \\PIPE\\lsarpc
      rationale: EFSRPC/LSARPC pipe reachable anonymously or with low-priv creds.
    - signal
      expectation: ["Domain Controller", "Certificate Authority"]
      rationale: High-value roles where coerced auth compromises the enterprise.
  boosters:
    - description
      weight: 8
    - description
      weight: 5
telemetry:
  existing_sources:
    - probe_runner
    - shodan_metadata
  needed_enhancements:
    - policy_sampling
references:
  - label
    url: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36942
  - label
    url: https://github.com/topotam/PetitPotam
notes:
  remediation_summary: Apply KB5005413, disable NTLM where possible, and enforce EPA on AD CS endpoints.
  reporting_tip: Suggest enabling SMB signing and disabling NTLM relay paths (LDAP signing, EPA) to break the attack chain.
