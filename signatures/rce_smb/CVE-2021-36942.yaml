metadata:
  cve_ids:
    - CVE-2021-36942
  name: PetitPotam
  aliases:
    - EFSRPC coerced authentication
  severity: high
  description: >-
    Coerces NTLM authentication by abusing the EFSRPC interface over SMB named pipes,
    enabling relay attacks that can lead to RCE on downstream systems.
heuristic:
  required_signals: 2
  base_weight: 20
  risk_band: low
  conditions:
    - signal: ipc_share_accessible
      expectation: true
      rationale: PetitPotam abuses EFSRPC over IPC$; access to IPC$ is a prerequisite.
    - signal: has_domain_role_indicators
      expectation: true
      rationale: Domain controllers or CA servers are prime targets for the coercion chain.
    - signal: host.anonymous_access
      expectation: true
      rationale: Anonymous/guest access makes triggering the relay significantly easier.
  boosters:
    - description: SYSVOL/NETLOGON shares exposed alongside IPC$ create seamless relay paths.
      weight: 8
    - description: Host reachable from untrusted networks (per Shodan data) raises the urgency.
      weight: 5
telemetry:
  existing_sources:
    - probe_runner
    - shodan_metadata
  needed_enhancements:
    - policy_sampling
references:
  - label: Microsoft Security Response Center (CVE-2021-36942)
    url: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36942
  - label: PetitPotam technical write-up
    url: https://github.com/topotam/PetitPotam
notes:
  remediation_summary: Apply KB5005413, disable NTLM where possible, and enforce EPA on AD CS endpoints.
  reporting_tip: Suggest enabling SMB signing and disabling NTLM relay paths (LDAP signing, EPA) to break the attack chain.
