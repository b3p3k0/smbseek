metadata:
  cve_ids:
    - CVE-2017-0143
    - CVE-2017-0146
  name: EternalRomance / EternalSynergy
  aliases:
    - MS17-010 family
  severity: high
  description: >-
    Alternative MS17-010 exploitation paths abusing trans2 requests to achieve RCE on
    SMB1-enabled systems that missed the full patch rollup.
heuristic:
  required_signals: 2
  base_weight: 35
  risk_band: high
  conditions:
    - signal: smb.negotiation.supports_smb1
      expectation: true
      rationale: Vulnerability requires SMB1 dialects.
    - signal: host.ms17_010_status
      expectation: missing
      rationale: Host lacks the complete MS17-010 patch set.
    - signal: host.os_detection
      expectation: windows
      rationale: EternalRomance/EternalSynergy only affect Windows SMB stacks.
  boosters:
    - description: Anonymous access enabled increases the chance of worm chaining.
      weight: 8
    - description: ADMIN$/IPC$ shares exposed without signing extend impact radius.
      weight: 5
telemetry:
  existing_sources:
    - access_runner
    - smb_negotiation
  needed_enhancements:
    - diagnostic_trans2_probe
references:
  - label: Microsoft Security Response Center (MS17-010)
    url: https://msrc.microsoft.com/update-guide/en-US/vulnerability/MS17-010
  - label: NCC Group analysis
    url: https://research.nccgroup.com/2017/05/19/detecting-smb-exploits/
notes:
  remediation_summary: Apply the entire MS17-010 rollup; do not rely on partial hotfixes.
  reporting_tip: Call out when both EternalBlue and EternalRomance heuristics fireâ€”indicates systemic patch gaps.
